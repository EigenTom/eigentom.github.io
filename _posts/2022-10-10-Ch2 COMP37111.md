---
layout:     post
title:      高级计算机图形学:色彩和动画
subtitle:   Color & Animation
date:       2022-10-10
author:     R1NG
header-img: img/post-bg-comp37111.jpg
description: 本章主要介绍对颜色的建模和关于动画的简单概念.
catalog: true
tags:
    - 课程笔记
    - 高级计算机图形学
---

# 色彩和动画

我们将在本章中简介对 **色彩** 的建模, 一般概念和具体表示, 并对动画的概念进行简单介绍.

## 色彩

### 物理学: 光
拥有色彩的是 **可见光** (`Visible Light`). 可见光是 **波长位于肉眼可视范围内**, 即 $450 - 700\text{nm}$ 范围内的 **电磁波**, 可见光的特征由其 **光谱** (`Spectrum`) 所描述. 它展现的是给定可见光中, 在整个可见光谱范围内, **每一种不同波长的光的相对能量大小**. 由于光的波长是 **无限可分** 的, 因此光谱图实际上是一条 **曲线**, 如下图所示:

![20221012123556](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012123556.png)

每一种光的光谱 (等价地, 或称颜色信号图) 都不相同, 我们可以使用一些工具将复合光还原. 从物理实验中的知识可知, 我们可用棱镜 (`Prism`) 或衍射光栅 (`Diffusion Grating`) 将复合光还原成组成它的多种彩色光:

![20221012125142](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012125142.png)

进一步地, 被成像设备 (传感器, 肉眼视网膜, 胶片等) 所接收到的光的 **光谱** 由 **不同波长的光本身包含的能量强度** 和 **不同波长的光在平面上反射造成的能量损失** 共同决定:

![20221012133616](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012133616.png)

换言之, 成像设备所接收到光的光谱不仅和这束光本身的组成有关, 同时和光反射的不同表面也有关系. 光在物体表面的反射是非常复杂的物理过程, 但可以被近似认为 “不同波长的光在不同种类的物体上反射之后其能量强度有所衰减”. 因此光谱图 (或色彩信号图) 中每个横轴 (波长) 对应的纵轴值 (能量强度) 就可被近似认为是: **特定波长的光本身包含的能量强度和物体表面对这一波长的光的反射系数的乘积**.

### 生物学: 光感细胞

视网膜上的光感细胞分为具有感知颜色功能的 **视锥细胞** (`Cone Cell`) 和擅长捕捉低亮度光源的 **视杆细胞** (`Rod Cell`). 其中, 视锥细胞分为可感知 **红, 绿, 蓝** 三原色的三种细胞 (`L`, `M`, `S`), 每种视锥细胞对光的感知强度都有不同, 这种对不同波长光的感知差异可以用下列的图表所表示:

![20221012140804](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012140804.png)

视锥细胞对给定的复合光所产生的刺激 (`Stimulus`) 可被计算为 **该复合光所包含的对应波长纯色光的信号强度** 和 **该类视锥细胞对这一纯色光的反馈强度** 乘积的 **积分**. 此处需要注意: 在任何情况下光对细胞产生的刺激 **总是正的**.

而由于这三种细胞在视网膜上同时存在, 因此整个视网膜的感光反馈 (`Respond`) 可被简单地 **线性叠加**. 

肉眼可感知的三原色恰好可以通过 **不同比例的混合** 构造出所有可见的颜色. 如下图所示, 显示器中的每个像素点都由 **红, 绿, 蓝** 三个子像素点组成, 通过调控子像素光强即可混合出不同的颜色.

![20221012141035](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012141035.png)

使用三原色构造出其他颜色的方法分为 **加色法** (`Color Additive Method`) 和 **减色法** (`Color Subtractive Method`). 下图中, 左侧展示的是通过加色法, 从三原色直接生成的不同颜色. 此处我们假设每个颜色通道取值都为 $0-255$, 可知三种颜色通过加色法混合后得到的是 $(255, 255, 255)$, 也就是说中心必为 **白色**, 对减色法来说中心就是深色. 一般地, 显示器基于加色法混合颜色, 而减色法用于印刷和染色.

![20221012141332](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012141332.png)

从不同波长的光强的角度看, 加色法和减色法所进行的操作实际就是对 **两种光谱不同的混合光** 的光谱曲线进行的 **叠加** 或 **相减** 操作. 如下图所示, 考虑混合光 $C_1$ (表为橙色) 和 $C_2$ (表为紫色), 则左侧和右侧的图分别表示通过加色法和减色法得到的光.

![20221012212504](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012212504.png)

需要注意, 由于不同视锥细胞对光的感知范围是 **部分重叠** 的, 因此如果我们将某束混合光中的蓝光部分 (也就是 $S$ 视锥细胞感知到的部分) 光强 **减半**, 得到的光在肉眼感知上并不是 “蓝色部分强度减半而其他不变”, 因为如下图所示, **蓝光部分其实和另两种视锥细胞的感知范围相重合**, 对这一范围的纯色光的强度所进行的削减同样会影响其他类别的视锥细胞对绿色和红色的感知.

### 光学: 基本概念

随后回顾一些基本概念: 

**定义** (强度)
> 光的 **强度** (`Intensity`) 由辐射量所定义, 单位为 `cd/m^2` (坎德拉/平方米), 在光谱图中表示为 **曲线和坐标轴围成的面积**. 因此, 若光线中某种纯色光的光强越大, 它在光谱图中对应的 $y$ 轴高度则越高.


**定义** (色相)
> 光的 **色相** (`Hue`) 指的是人眼所实际感受到的颜色, 由 **光谱图中占主导地位 (`Predominant`) 的纯色光波长** 决定.
> 
>如下图所示: 三束人眼分别感受为 **蓝色, 黄色和红色** 的光的光谱图如下, 它们的主导色就是光谱曲线最高点对应的波长: 即虚线所示的部分.
>
> ![20221012213722](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012213722.png)
> 

**定义** (饱和度 | 色彩浓度)
> 光的 **饱和度 | 色彩浓度** (`Saturation | Chroma`) 描述了 **色彩的鲜艳程度**, 取决于该色中 **含色成分** 和 **消色成分** (`Achromatic`) 的比例: 含色成分越大则饱和度越大, 反之亦然. 在光谱图中, 表现为色彩分布曲线相对最高的均值位置的聚集程度 (方差). 聚集程度越高, 则饱和度越大. 

不难看出, 光的 **强度**, **饱和度** 和 **色相** 不可单独调整, 牵一发而动全身. 我们有下列的 `HSI` 色彩模型描述这三个参数的关系:

![20221012214604](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012214604.png)

### 标准: 色彩空间

为了 **准确地, 标准化地** 描述和还原颜色, 我们需要 **标准户** 颜色的描述方式: **色彩空间**. 

色彩空间可以用多种方式定义, 即使我们使用视锥细胞的光强反馈图 (`Cone Response`) 表示也是可以的. 由于人类的色彩视觉是 **三维** 且 **线性** 的, 我们可将不同色彩 **在三维空间内描述**. 最常用的色彩空间定义是 `CIE-XYZ`.

在 `CIE` 色彩标准诞生的年代尚无计算机和其他一系列先进的测量设备. 在那个年代, 确定光中三原色分布的方式是:

构造一个从中间完全隔断的光屏, 左侧打入 **被测光源**, 右侧打入 **由红, 绿, 蓝三原色混合而成的光**, 令被试者观察二者的差异. 手动调价三原色的混合比例直到被试者 **看不出区别**, 此时就得到了被测光源的 **三原色混合比例**.

![20221012215310](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012215310.png)

将这样的测试对全光谱范围内的绝大多数光做一遍, 就得到了不同光的三原色混合比例. `CIE` 标准还规定了作为色彩空间的基色的三原色的波长为:

1. 蓝色: $435.8$ nm
2. 绿色: $541.6$ nm
3. 红色: $700$ nm

此外, 不同色彩空间内的表示可以被 **互相转换**. 在其他色彩空间下定义的颜色经过表示上的转换后就可以在 `CIE-XYZ` 色彩空间中表示为三基色的合成. 三基色的权重也被称为 **三刺激值** (`Tristimulus Values`).

由于其他色彩空间选用的基色波长不同, 一些颜色经过转换后对应的刺激值可能是 **负值**. 在这种情况下, 需要使用其他基色的光补光.

考虑下面的例子: 假设人眼视锥细胞的实际感光曲线如下图所示, 则视网膜在感受竖虚线所描述的光时, 其实际感受方式是: **主要感受蓝光和绿光的两种视锥细胞在这一波长的光下给予了不同的正反馈**, 而感受红光的视锥细胞给予了负反馈, **三者叠加** 得到了视网膜对这种光的总反馈, 但这并非色彩空间定义颜色的方式, 这样的色彩也无法被色彩空间 **直接表示**.

![20221012220323](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012220323.png)

解决方案就是 **使用另两种基色补光** 以 **填充掉特定类型视锥细胞对这一波长颜色的负反馈**, 如下图所示:

![20221012220527](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012220527.png)

和其他色彩标准一样, `CIE` 标准定义的色彩空间是 **三维的**. 为了方便展示和理解, 我们将色彩空间 **投影到二维平面上**, 就得到了 **色度图** (`Chromaticity Diagram`). 并且, 实际色彩空间中构成给定颜色的三刺激值 $X, Y, Z$ 和色度图中的横纵坐标 $x, y$ 之间的关系如下图所示:

![20221012220841](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221012220841.png)

### 伽马校正

**伽马校正** (`Gamma Correction`) 是一种用于编码和解码视频或图像中 **亮度** 或 **三刺激值** 的 **非线性操作**, 其目的是: 利用人类感知光线和颜色的 **非线性方式**: 人对较暗色调之间的相对差异相比浅色调而言更敏感, 从而让暗色的过渡更平滑, 防止出现肉眼可见的断层.

## 动画

回顾之前的内容, 我们已经介绍了曲线建模, 曲面建模和色彩标准, 下一步我们将简介 **动画** 的基本定义和原则. 

动画基本是在 **建模** 基础上的扩展延伸, 其描述的是模型在时间上一系列的连续 **变换** 或 **动作**, 得到的是一系列基于时间顺序的流畅, 连续的图片.

对于电影, 最基本的 “流畅帧率” 为 $24\text{fps}$, 而对 `VR` 而言则需要至少 $90\text{fps}$.

从 **动画制作人** 的角度, 我们需要了解 `Rigging`, `Skinning` 和 `Posing`. 而从 **数据驱动的动画** 角度, 我们将简要讨论如何通过 **动作捕捉** (`Motion Capture`) 制作和得到动画; 若考虑 **基于过程的动画** (`Procedual Animation`), 所需要考虑的是如何进行 **物理建模** (`Physical Simulation`), 如 **织物模拟**.

### 基本概念: 挤压, 拉伸和时序

最基本的概念是 **挤压** (`Squash`) 和 **拉伸** (`Stretch`). **挤压** 指用外力将物体压平, 或物体对自身施加类似的压力. 而 **拉伸** 的目的是 **加速**, 并同时和 **挤压** 形成明显的对比. 

![20221013155705](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221013155705.png)

另一个重要概念是 **时序** (`Timing`). 物体的重量受其时序的影响: 更轻的物体运动的速度更快. 同时, 时序也会对动画的插值产生影响: 运动速度不同的物体在相同时间差之间的两帧动画之间运动的距离不同, 要在这段时间内补帧, 插值得到的中间帧上物体的位置也会有所不同.

### 对物体运动的建模和描述

下面讨论如何描述和建模物体在场景中的运动. 

对物体运动的描述有两种类别: 第一种是以动画, 电影为首的 `Production`: 预先设定好场景中物体的运动轨迹, 然后在 **完整渲染出动画后** 直接播放. 由于有充足的时间和资源进行计算, 我们可以得到视觉效果更好的产品; 另一种 `Interactive` 以游戏和虚拟现实为例: 使用者可以和场景中的物体进行交互, 实时改变物体的运动方式与轨迹. 由于对延迟的要求极高, 因此难以实现如同 `Production` 一般的真实度和质量.

### 关键帧和补帧

前面已经提到, 对电影, 视频和虚拟现实或游戏, 满足基本需求的动画帧速率为 $24$, $30$ 和 $90$. 显然我们不可能在生产中进行 **逐帧绘制**, 因此需要求助于 **关键帧** 技术 (`Keyframe`). 其基本思想是: 只手动绘制描述动画 **关键节点** 的数帧 (也就是关键帧), 然后对关键帧之间缺失的部分进行 **自动插值补帧**, 也称 `Tweening`.

![20221013160816](https://cdn.jsdelivr.net/gh/KirisameR/KirisameR.github.io/img/blogpost_images/20221013160816.png)

### 过程式动画生成

过程式动画生成的基本思想是: 使用 **确定的函数表达式**, 基于一系列 **参数** 对物体的运动进行 **描述** 和 **控制**. 比较常见的例子包括 **对时钟的时针, 分针和秒针建模**, 以及对 **随风摆动的草地** 和 **逐渐消散的白云** 建模等. 这些动画共同的特点是: 它们所包含的运动具有 **确定性**, 可以被准确清晰地描述. 

